<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ™¯é»è©³ç´°è³‡è¨Š | TravelGo</title>
  <style>
    body {
      font-family: "Noto Sans TC", sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #ff8c42;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.8rem;
    }
    .container {
      max-width: 800px;
      margin: 2rem auto;
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      padding: 1.5rem;
    }
    .spot-img {
      width: 100%;
      height: 400px;
      object-fit: cover;
      border-radius: 8px;
    }
    h2 {
      color: #ff8c42;
      margin-top: 1rem;
    }
    p {
      color: #333;
      line-height: 1.6;
    }
    .map-link {
      margin-top: 1.5rem;
      text-align: center;
    }
    .map-link a {
      text-decoration: none;
      background-color: #ff8c42;
      color: white;
      padding: 0.6rem 1rem;
      border-radius: 6px;
      display: inline-block;
      transition: background-color 0.3s;
    }
    .map-link a:hover {
      background-color: #e6731d;
    }
    iframe {
      width: 100%;
      height: 315px;
      border: none;
      margin-top: 1.5rem;
      border-radius: 8px;
    }
    .comment-section {
      margin-top: 2rem;
      border-top: 2px solid #eee;
      padding-top: 1.5rem;
    }
    .comment-section h3 {
      color: #ff8c42;
      margin-bottom: 1rem;
    }
    .comment-form {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
      margin-bottom: 1.5rem;
    }
    .comment-form input,
    .comment-form textarea {
      padding: 0.7rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      width: 100%;
      box-sizing: border-box;
    }
    .comment-form button {
      background-color: #ff8c42;
      color: white;
      padding: 0.6rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s;
      align-self: flex-end;
    }
    .comment-form button:hover {
      background-color: #e6731d;
    }
    .comment {
      background-color: #f2f2f2;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    .comment strong {
      color: #333;
      font-weight: 600;
    }
    .comment p {
      margin: 0.3rem 0 0 0;
      color: #444;
    }

    footer {
      background-color: #333;
      color: white;
      text-align: center;
      padding: 1rem;
      position: fixed;
      left: 0;
      bottom: 0;
      width: 100%;
      z-index: 100;
      transition: transform 0.4s;
    }
  </style>
</head>
<body>
  <header>æ™¯é»è©³ç´°è³‡è¨Š</header>
  <div class="container" id="detail-container">è¼‰å…¥ä¸­...</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCfT20L-v8VdPg5jY0wWCzjTvAEPQwSoAs",
      authDomain: "comments-c9216.firebaseapp.com",
      databaseURL: "https://comments-c9216-default-rtdb.firebaseio.com",
      projectId: "comments-c9216",
      storageBucket: "comments-c9216.appspot.com",
      messagingSenderId: "920624408343",
      appId: "1:920624408343:web:a901291a83557c7227f952",
      measurementId: "G-EVWSLGGNDC"
    };
    const app = initializeApp(firebaseConfig);
    const db = getDatabase();
    const auth = getAuth(app);

    // å–å¾—ç•™è¨€åœ°é» ID
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");
    const container = document.getElementById("detail-container");

    if (!id) {
      container.innerHTML = "âŒ ç„¡æ•ˆçš„æ™¯é» IDã€‚";
    } else {
      fetch("https://tdx.transportdata.tw/api/basic/v2/Tourism/ScenicSpot?$format=JSON")
        .then(res => res.json())
        .then(async data => {
          const spot = data.find(s => s.ScenicSpotID === id);
          if (!spot) {
            container.innerHTML = "âŒ æ‰¾ä¸åˆ°æ™¯é»è³‡è¨Šã€‚";
            return;
          }

          const name = spot.ScenicSpotName || "æœªå‘½åæ™¯é»";
          const desc = spot.DescriptionDetail || "ç„¡è©³ç´°ä»‹ç´¹";
          const address = spot.Address || "ç„¡åœ°å€è³‡è¨Š";
          const img = spot.Picture?.PictureUrl1 || "ç„¡åœ–ç‰‡.png";
          const mapQuery = encodeURIComponent(name);

          const API_KEY = "AIzaSyB_wJyzDT4coO3qI29HFVUnHHsrYs5NsRQ";
          const videoId = await fetch(`https://www.googleapis.com/youtube/v3/search?key=${API_KEY}&part=snippet&type=video&maxResults=1&q=${mapQuery}`)
            .then(res => res.json())
            .then(json => json.items?.[0]?.id?.videoId)
            .catch(() => null);

          const youtubeEmbed = videoId
            ? `<h3>ğŸ¬ ç›¸é—œå½±ç‰‡</h3><iframe src="https://www.youtube.com/embed/${videoId}" allowfullscreen></iframe>`
            : `<div style="text-align:center; margin-top:1.5rem;">
                <a href="https://www.youtube.com/results?search_query=${mapQuery}" target="_blank">
                  ğŸ” ç„¡æ³•è‡ªå‹•å–å¾—å½±ç‰‡ï¼Œé»æˆ‘åˆ° YouTube æœå°‹
                </a>
              </div>`;

          container.innerHTML = `
            <img class="spot-img" src="${img}" alt="${name}" onerror="this.src='ç„¡åœ–ç‰‡.png'">
            <h2>${name}</h2>
            <p>${desc}</p>
            <p><strong>åœ°å€ï¼š</strong>${address}</p>
            <div class="map-link">
              <a href="https://www.google.com/maps/search/?q=${mapQuery}" target="_blank">
                ğŸ“ åœ¨ Google åœ°åœ–ä¸ŠæŸ¥çœ‹
              </a>
            </div>
            ${youtubeEmbed}
            <div class="comment-section">
              <h3>ğŸ—¨ï¸ æ™¯é»è©•è«–</h3>
              <form class="comment-form" id="comment-form">
                <textarea id="comment" rows="3" placeholder="åˆ†äº«ä½ çš„å¿ƒå¾—..." required></textarea>
                <button type="submit">é€å‡ºè©•è«–</button>
              </form>
              <div id="comments-container"></div>
            </div>
          `;

          const form = document.getElementById("comment-form");
          const commentsContainer = document.getElementById("comments-container");

          let userEmail = "åŒ¿åç”¨æˆ¶";

          // ç›£è½ç™»å…¥ç‹€æ…‹
          onAuthStateChanged(auth, user => {
            if (user) {
              userEmail = user.email || "åŒ¿åç”¨æˆ¶";
            }
          });

          // æäº¤è©•è«–
          form.addEventListener("submit", async (e) => {
            e.preventDefault();
            const text = document.getElementById("comment").value.trim();
            if (!text) return;

            const newComment = {
              email: userEmail,
              text,
              timestamp: Date.now()
            };

            // ç«‹å³é¡¯ç¤º
            const el = document.createElement("div");
            el.className = "comment";
            el.innerHTML = `<strong>${newComment.email}</strong><p>${newComment.text}</p>`;
            commentsContainer.prepend(el);

            await push(ref(db, `comments/${id}`), newComment);
            form.reset();
          });

          // è¼‰å…¥ç•™è¨€
          onValue(ref(db, `comments/${id}`), (snapshot) => {
            const comments = snapshot.val();
            if (comments) {
              commentsContainer.innerHTML = "";
              const sorted = Object.values(comments).sort((a, b) => b.timestamp - a.timestamp);
              sorted.forEach(c => {
                const el = document.createElement("div");
                el.className = "comment";
                el.innerHTML = `<strong>${c.email}</strong><p>${c.text}</p>`;
                commentsContainer.appendChild(el);
              });
            }
          });
        })
        .catch(() => {
          container.innerHTML = "âŒ è³‡æ–™è¼‰å…¥å¤±æ•—ã€‚";
        });
    }
  </script>
  <footer>
    Â© 2025 TravelGo å—éƒ¨æ™¯é»æ¨è–¦é  | è£½ä½œå°çµ„ï¼šèµ°å§ï¼æ—…è¡Œè¶£
  </footer>
  <script>
    // ===== 3. Footer æ»‘å‹•æ•ˆæœ =====
      let lastScrollY = window.scrollY;
      const footer = document.querySelector('footer');

      function handleFooter() {
        if (window.scrollY > lastScrollY) {
          // å‘ä¸‹æ²å‹•ï¼Œfooteræ»‘å…¥
          footer.style.transform = 'translateY(0)';
        } else {
          // å‘ä¸Šæ²å‹•ï¼Œfooteræ»‘å‡º
          footer.style.transform = 'translateY(100%)';
        }
        lastScrollY = window.scrollY;
      }

      window.addEventListener('scroll', handleFooter);

      // é è¨­footeréš±è—
      footer.style.transition = 'transform 0.4s';
      footer.style.transform = 'translateY(100%)';
  </script>
</body>
</html>
